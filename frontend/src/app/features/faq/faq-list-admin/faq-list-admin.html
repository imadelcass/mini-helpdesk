<div class="container mx-auto p-4">
  <h1 class="text-3xl font-bold m-0">FAQ</h1>
  <div class="flex justify-between items-center my-4">
    <p-button
      type="button"
      label="Add FAQ"
      icon="pi pi-plus"
      class="p-button-success"
      (click)="openCreateDialog()"
    ></p-button>
    <input
      pInputText
      type="text"
      (input)="dt.filterGlobal($event.target.value, 'contains')"
      placeholder="Search keyword"
    />
  </div>

  <p-divider></p-divider>

  <div class="card">
    <p-table
      #dt
      stripedRows
      [columns]="cols"
      [value]="allFaqs()"
      [scrollable]="true"
      scrollHeight="600px"
      [rows]="10"
      [virtualScroll]="true"
      [virtualScrollItemSize]="120"
      [lazy]="true"
      (onLazyLoad)="onLazyLoad($event)"
      (onFilter)="onFilter($event)"
      [loading]="faqService.loading()"
    >
      <ng-template #header let-columns>
        <tr>
          @for(column of columns; track column) {
          <th
            [pSortableColumn]="column.field"
            [pSortableColumnDisabled]="!column.isSortable"
            pFrozenColumn
            [frozen]="column.isFrozen"
            [alignFrozen]="column.alignFrozen"
          >
            {{ column.header }}
            @if(column.isSortable) {
              <p-sortIcon [field]="column.field" />
            }
          </th>
          }
        </tr>

        <tr>
          <th>
            <p-columnFilter type="text" field="question" [showMenu]="false"></p-columnFilter>
          </th>
          <th>
            <p-columnFilter type="text" field="answer" [showMenu]="false"></p-columnFilter>
          </th>
          <th>
            <p-columnFilter field="category" matchMode="equals" [showMenu]="false">
              <ng-template #filter let-value let-filter="filterCallback">
                <p-select
                  id="category"
                  [options]="faqService.categories()"
                  (onChange)="filter($event.value)"
                  optionLabel="name"
                  optionValue="name"
                  [showClear]="true"
                ></p-select>
              </ng-template>
            </p-columnFilter>
          </th>
          <th></th>
          <th></th>
        </tr>
      </ng-template>

      <ng-template let-faq let-columns="columns" pTemplate="body">
        <tr class="h-[120px]">
          <!-- Question Column -->
          <td class="min-w-32">
            <div class="font-medium text-900 line-clamp-1 overflow-hidden text-ellipsis">
              {{ faq.question }}
            </div>
          </td>

          <!-- Answer Column -->
          <td class="min-w-32">
            <div class="text-600 line-clamp-1 overflow-hidden text-ellipsis">
              {{ faq.answer }}
            </div>
          </td>

          <!-- Category Column -->
          <td class="min-w-48">
            <p-tag [value]="faq.category?.name"></p-tag>
          </td>

          <!-- Created At Column -->
          <td class="min-w-32">
            <div class="text-600">
              {{ faq.created_at | date : 'shortDate' }}
            </div>
          </td>

          <!-- Actions Column -->
          <td pFrozenColumn [frozen]="true" alignFrozen="right">
            <div class="flex gap-1">
              <button
                pButton
                pRipple
                icon="pi pi-pencil"
                class="p-button-primary p-button-text p-button-sm"
                pTooltip="Edit FAQ"
                tooltipPosition="top"
                (click)="onEdit(faq)"
              ></button>

              <div>
                <button
                  pButton
                  pRipple
                  icon="pi pi-trash"
                  class="p-button-danger p-button-text p-button-sm"
                  pTooltip="Delete FAQ"
                  tooltipPosition="top"
                  (click)="onDelete(faq.id)"
                ></button>
              </div>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <app-faq-form [(visible)]="showFaqForm" [faq]="selectedFaq" (saved)="onFaqSaved()">
  </app-faq-form>
</div>