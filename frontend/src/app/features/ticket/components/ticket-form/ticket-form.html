<p-dialog
  header="Modifier le ticket"
  [modal]="true"
  [(visible)]="visible"
  [style]="{ width: '42rem', maxWidth: '90vw' }"
  [dismissableMask]="true"
>
  <!-- Form -->
  <form [formGroup]="ticketForm" class="grid grid-cols-1 md:grid-cols-2 gap-5 py-4">
    <!-- Title -->
    <div class="col-span-1">
      <label for="title" class="block text-sm font-medium text-gray-700 mb-1">Titre</label>
      <input
        pInputText
        pSize="small"
        id="title"
        formControlName="title"
        placeholder="Entrer le titre"
        class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm"
      />
      @if (isFieldInvalid('title')) {
      <small class="text-red-500 text-xs mt-1 flex items-center gap-1">
        <i class="pi pi-exclamation-circle text-xs"></i>
        {{ getFieldError('title') }}
      </small>
      }
    </div>

    <!-- Category -->
    <div class="col-span-1">
      <label for="ticket_category_id" class="block text-sm font-medium text-gray-700 mb-1"
        >Catégorie</label
      >
      <p-select
        id="ticket_category_id"
        formControlName="ticket_category_id"
        [options]="ticketService.categories()"
        optionLabel="name"
        optionValue="id"
        class="w-full"
        placeholder="Sélectionner une catégorie"
        [showClear]="true"
        [filter]="true"
      ></p-select>
    </div>

    <!-- Status -->
    <div class="col-span-1">
      <label for="status" class="block text-sm font-medium text-gray-700 mb-1">Statut</label>
      <p-select
        id="status"
        formControlName="status"
        [options]="ticketService.getStatuses()"
        optionLabel="label"
        optionValue="value"
        class="w-full"
        placeholder="Sélectionner un statut"
      ></p-select>
    </div>

    <!-- Priority -->
    <div class="col-span-1">
      <label for="priority" class="block text-sm font-medium text-gray-700 mb-1">Priorité</label>
      <p-select
        id="priority"
        formControlName="priority"
        [options]="ticketService.getPriorities()"
        optionLabel="label"
        optionValue="value"
        class="w-full"
        placeholder="Sélectionner une priorité"
      ></p-select>
    </div>

    <!-- Description -->
    <div class="col-span-1 md:col-span-2">
      <label for="description" class="block text-sm font-medium text-gray-700 mb-1"
        >Description</label
      >
      <textarea
        pInputTextarea
        id="description"
        formControlName="description"
        [rows]="4"
        placeholder="Entrer la description détaillée..."
        class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm resize-none"
      ></textarea>
      @if (isFieldInvalid('description')) {
      <small class="text-red-500 text-xs mt-1 flex items-center gap-1">
        <i class="pi pi-exclamation-circle text-xs"></i>
        {{ getFieldError('description') }}
      </small>
      }
    </div>
  </form>

  <!-- Footer Buttons -->
  <div class="flex justify-end gap-3 border-t border-gray-100 pt-3">
    <button
      pButton
      label="Annuler"
      severity="secondary"
      class="!text-gray-700 !bg-gray-100 hover:!bg-gray-200 !border-0"
      (click)="onCancel()"
    ></button>
    <button
      pButton
      label="Enregistrer"
      icon="pi pi-save"
      class="!bg-primary-500 hover:!bg-primary-600 !text-white !border-0"
      (click)="onSave()"
    ></button>
  </div>
</p-dialog>
