<div class="bg-white rounded-xl shadow-sm border border-gray-100 flex flex-col">
  <!-- Column Header -->
  <div
    class="px-4 py-3 border-b border-gray-100 flex items-center justify-between bg-gradient-to-r from-blue-50 to-transparent rounded-t-xl"
  >
    <h2 class="text-lg font-semibold text-gray-800 tracking-tight">
      {{ status.label }}
    </h2>
    <span class="text-xs font-medium text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full">
      {{ tickets().length || 0 }}
    </span>
  </div>
  <!-- Tickets List -->
  <div class="flex-1 overflow-y-auto p-3 space-y-3">
    <p-table
      [value]="tickets()"
      [scrollable]="false"
      scrollHeight="500px"
      [rows]="10"
      [virtualScroll]="true"
      [virtualScrollItemSize]="140"
      [lazy]="true"
      [loading]="loading()"
      (onLazyLoad)="onLazyLoad($event)"
    >
      <ng-template pTemplate="body" let-ticket>
        <tr class="h-[140px]">
          <td>
            <!-- Enhanced ticket card with hover effects -->
            <div class="group relative">
              <div
                class="!w-full p-4 bg-gradient-to-br from-white to-gray-50 hover:from-white hover:to-blue-50 border border-gray-200 hover:border-blue-300 rounded-xl transition-all duration-300 cursor-pointer hover:shadow-lg hover:-translate-y-0.5"
                (click)="onTicketClicked(ticket.id)"
              >
                <!-- Header with ID, Title, and Status -->
                <div class="flex items-start justify-between gap-3 mb-3">
                  <div class="flex-1 min-w-0">
                    <h3 class="font-semibold text-gray-900 text-sm line-clamp-1">
                      {{ ticket.title }}
                    </h3>
                    <span class="text-xs text-gray-500 font-medium"> #{{ ticket.id }} </span>
                  </div>
                  <span
                    class="text-xs font-semibold px-2.5 py-1 rounded-lg shadow-sm flex-shrink-0"
                    [ngClass]="{
                      'bg-gradient-to-r from-yellow-100 to-yellow-50 text-yellow-700 border border-yellow-200':
                        ticket.status === 1,
                      'bg-gradient-to-r from-gray-100 to-gray-50 text-gray-700 border border-gray-200':
                        ticket.status === 2,
                      'bg-gradient-to-r from-green-100 to-green-50 text-green-700 border border-green-200':
                        ticket.status === 3
                    }"
                  >
                    {{ ticketService.getStatusLabel(ticket.status) }}
                  </span>
                </div>

                <!-- Description -->
                <p class="text-sm text-gray-600 line-clamp-1 leading-relaxed">
                  {{ ticket.description }}
                </p>

                <!-- Action Buttons - Show on hover -->
                <div
                  class="absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex gap-1.5 bg-white/95 backdrop-blur-sm rounded-lg shadow-lg p-1 border border-gray-200"
                >
                  <!-- Update button -->
                  @if(canUpdateTicket(ticket)) {
                  <p-button
                    variant="text"
                    size="small"
                    icon="pi pi-pencil"
                    (click)="onEditTicket(ticket); $event.stopPropagation()"
                  >
                  </p-button>
                  }

                  <!-- Delete button -->
                  <p-button
                    variant="text"
                    size="small"
                    severity="danger"
                    icon="pi pi-trash"
                    (click)="onDeleteTicket(ticket); $event.stopPropagation()"
                  >
                  </p-button>
                </div>
              </div>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<app-ticket-detail
  [ticketId]="selectedTicketId"
  [(visible)]="showTicketDetailDialog"
></app-ticket-detail>

<app-ticket-form
  [(visible)]="showTicketForm"
  [ticket]="selectedTicket"
  (saved)="onTicketSaved()"
></app-ticket-form>
