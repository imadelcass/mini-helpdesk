<div class="container mx-auto p-4">
  <h1 class="text-3xl font-bold m-0">TICKET</h1>
  <div class="flex justify-between items-center my-4">
    <p-button
      type="button"
      label="Add TICKET"
      icon="pi pi-plus"
      class="p-button-success"
      (click)="openCreateDialog()"
    ></p-button>
    <input pInputText type="text" placeholder="Search..." class="mr-2" [(ngModel)]="searchQuery" />
  </div>

  <p-divider></p-divider>

  <div class="card">
    <p-table
      stripedRows
      [columns]="cols"
      [value]="allTickets"
      [scrollable]="true"
      scrollHeight="500px"
      [rows]="10"
      [virtualScroll]="true"
      [virtualScrollItemSize]="80"
      [lazy]="true"
      [loading]="ticketService.loading()"
      (onLazyLoad)="onLazyLoad($event)"
    >
      <ng-template #header let-columns>
        <tr>
          @for(column of columns; track column) {
          <th>{{ column.header }}</th>
          }
        </tr>
      </ng-template>
      <ng-template let-ticket let-columns="columns" pTemplate="body">
        <tr class="h-[80px]">
          <!-- Title Column -->
          <td class="min-w-32">
            <div class="font-medium text-900 line-clamp-1 overflow-hidden text-ellipsis">
              {{ ticket.title }}
            </div>
          </td>
          <!-- Description Column -->
          <td class="min-w-32">
            <div class="text-600 line-clamp-1 overflow-hidden text-ellipsis">
              {{ ticket.description }}
            </div>
          </td>
          <!-- Priority Column -->
          <td>{{ ticketService.getPriorityLabel(ticket.priority) }}</td>
          <!-- Status Column -->
          <td>{{ ticketService.getStatusLabel(ticket.status) }}</td>

          <!-- Category Column -->
          <td class="min-w-48">
            <p-tag [value]="ticket.category?.name"></p-tag>
          </td>
          <!-- Created At Column -->
          <td class="min-w-32">
            <div class="text-600">
              {{ ticket.created_at | date : 'shortDate' }}
            </div>
          </td>

          <!-- Actions Column -->
          <td>
            <div class="flex gap-1">
              <button
                pButton
                pRipple
                icon="pi pi-pencil"
                class="p-button-primary p-button-text p-button-sm"
                pTooltip="Edit ticket"
                tooltipPosition="top"
                (click)="onEdit(ticket)"
              ></button>

              <div>
                <button
                  pButton
                  pRipple
                  icon="pi pi-trash"
                  class="p-button-danger p-button-text p-button-sm"
                  pTooltip="Delete ticket"
                  tooltipPosition="top"
                  (click)="onDelete(ticket.id)"
                ></button>
              </div>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <app-ticket-form
    [(visible)]="showTicketForm"
    [ticket]="selectedTicket"
    (saved)="onTicketSaved($event)"
  >
  </app-ticket-form>
</div>
